<div id="report_detail_modal" class="modal modal-open z-50 font-sans">
    
    <div class="modal-box w-11/12 max-w-3xl p-0 bg-base-100 shadow-2xl rounded-xl relative overflow-hidden flex flex-col max-h-[90vh]">
        
        <div class="bg-primary text-primary-content px-6 py-4 flex justify-between items-center shadow-md shrink-0">
            <h3 class="font-bold text-lg flex items-center gap-2">
                {% if report.status == 'ACKNOWLEDGED' %}
                    üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß)
                {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
                {% endif %}
            </h3>
            <button type="button" onclick="closeModal()" class="btn btn-sm btn-circle btn-ghost text-white hover:bg-white/20">
                ‚úï
            </button>
        </div>

        <div class="p-6 overflow-y-auto bg-base-100 flex-1 custom-scrollbar">
            
            <div class="flex flex-col md:flex-row gap-4 mb-6 border-b border-base-200 pb-4">
                <div class="flex-1">
                    <div class="text-xs text-gray-500 uppercase tracking-wide mb-1">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
                    <div class="font-bold text-lg text-primary flex items-center gap-2">
                        {{ report.job_application.student.user.get_full_name }}
                    </div>
                    <div class="text-sm text-gray-400 font-mono mt-0.5">
                        ‡∏£‡∏´‡∏±‡∏™: {{ report.job_application.student.student_code }}
                    </div>
                </div>
                <div class="flex-1 md:text-right">
                    <div class="text-xs text-gray-500 uppercase tracking-wide mb-1">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
                    <div class="font-bold text-gray-800 text-lg">
                        Week {{ report.week_number }}
                    </div>
                    <div class="text-xs text-gray-400 mt-1">
                        {{ report.job_application.company.name }}
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                
                <div class="card bg-base-200/50 border border-base-200">
                    <div class="card-body p-4">
                        <h4 class="font-bold text-gray-700 text-sm mb-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô
                        </h4>
                        <p class="text-gray-600 text-sm whitespace-pre-line leading-relaxed">{{ report.work_summary }}</p>
                    </div>
                </div>

                <div class="card bg-red-50 border border-red-100">
                    <div class="card-body p-4">
                        <h4 class="font-bold text-error text-sm mb-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö
                        </h4>
                        <p class="text-gray-700 text-sm whitespace-pre-line leading-relaxed">{{ report.problems_found|default:"- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤ -" }}</p>
                    </div>
                </div>

                <div class="card bg-green-50 border border-green-100">
                    <div class="card-body p-4">
                        <h4 class="font-bold text-success text-sm mb-2 flex items-center gap-2">
                            üí° ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </h4>
                        <p class="text-gray-700 text-sm whitespace-pre-line leading-relaxed">{{ report.solution|default:"-" }}</p>
                    </div>
                </div>

                <div class="card bg-blue-50 border border-blue-100">
                    <div class="card-body p-4">
                        <h4 class="font-bold text-info text-sm mb-2 flex items-center gap-2">
                            üìÖ ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏´‡∏ô‡πâ‡∏≤
                        </h4>
                        <p class="text-gray-700 text-sm whitespace-pre-line leading-relaxed">{{ report.next_week_plan|default:"-" }}</p>
                    </div>
                </div>

                {% if report.images.all %}
                <div class="pt-2">
                    <h4 class="font-bold text-gray-700 text-sm mb-3">üñºÔ∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        {% for img in report.images.all %}
                        <a href="{{ img.image.url }}" target="_blank" class="block group relative overflow-hidden rounded-lg shadow-sm border border-base-200 bg-gray-100">
                            <img src="{{ img.image.url }}" class="w-full h-32 object-cover transition-transform duration-300 group-hover:scale-110" alt="Work Image">
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                                <span class="opacity-0 group-hover:opacity-100 text-white text-xs bg-black/50 px-2 py-1 rounded">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà</span>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

            </div>
        </div>

        <div class="p-4 bg-base-100 border-t border-base-200 shrink-0 z-10">
            {% if report.status == 'ACKNOWLEDGED' or report.status == 'APPROVED' %}
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 bg-success/10 p-3 rounded-lg border border-success/20">
                    <div class="text-sm">
                        <span class="font-bold text-success flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                            ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß
                        </span>
                        {% if report.teacher_comment %}
                            <p class="text-gray-600 mt-1 italic">"{{ report.teacher_comment }}"</p>
                        {% endif %}
                    </div>
                    <button onclick="closeModal()" class="btn btn-neutral btn-sm min-w-[100px]">‡∏õ‡∏¥‡∏î</button>
                </div>
            {% else %}
                <form hx-post="{% url 'acknowledge-report' report.id %}" 
                      hx-target="#report-list-container"
                      hx-on:htmx:after-request="closeModal()"
                      class="flex flex-col gap-3">
                    {% csrf_token %}
                    
                    <div class="form-control">
                        <label class="label py-1">
                            <span class="label-text font-bold text-gray-700">üí¨ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏à‡∏≤‡∏Å‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå (Optional)</span>
                        </label>
                        <textarea name="teacher_comment" 
                                  class="textarea textarea-bordered w-full h-20 focus:textarea-primary" 
                                  placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á..."></textarea>
                    </div>

                    <div class="flex justify-end gap-3 mt-1">
                        <button type="button" onclick="closeModal()" class="btn btn-ghost text-gray-500 hover:bg-gray-100">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button type="submit" class="btn btn-primary text-white shadow-lg px-6 gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                            ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö / ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        </button>
                    </div>
                </form>
            {% endif %}
        </div>

    </div>

    <div class="modal-backdrop bg-black/60 fixed inset-0 -z-10" onclick="closeModal()"></div>
</div>

<script>
    // Script ‡∏õ‡∏¥‡∏î Modal (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å)
    if (typeof closeModal !== 'function') {
        function closeModal() {
            const container = document.getElementById('modal-container');
            if (container) container.innerHTML = '';
            
            const modal = document.getElementById('report_detail_modal');
            if (modal) modal.remove();
        }
    }
</script>